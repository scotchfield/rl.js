/*! rl.js 2015-09-10 */
var rl=function(){"use strict";var a={},b=[],c=!1,d=!1,e=[],f={},g={},h={},i={width:40,height:25,tileWidth:24,tileHeight:24,backgroundColor:"#000000",foregroundColor:"#ffffff",font:"20pt monospace",fontFillStyle:"#ffffff",textAlign:"center",imageSmoothingEnabled:!1,baseAlpha:.3};return a.key={space:{keyCode:32},left:{keyCode:37},up:{keyCode:38},right:{keyCode:39},down:{keyCode:40},0:{keyCode:48},1:{keyCode:49},2:{keyCode:50},3:{keyCode:51},4:{keyCode:52},5:{keyCode:53},6:{keyCode:54},7:{keyCode:55},8:{keyCode:56},9:{keyCode:57},a:{keyCode:65},b:{keyCode:66},c:{keyCode:67},d:{keyCode:68},e:{keyCode:69},f:{keyCode:70},g:{keyCode:71},h:{keyCode:72},i:{keyCode:73},j:{keyCode:74},k:{keyCode:75},l:{keyCode:76},m:{keyCode:77},n:{keyCode:78},o:{keyCode:79},p:{keyCode:80},q:{keyCode:81},r:{keyCode:82},s:{keyCode:83},t:{keyCode:84},u:{keyCode:85},v:{keyCode:86},w:{keyCode:87},x:{keyCode:88},y:{keyCode:89},z:{keyCode:90},less_than:{keyCode:188,shiftKey:!0},greater_than:{keyCode:190,shiftKey:!0}},a.TileBlocking=function(){return this instanceof a.TileBlocking?void 0:new a.TileBlocking},a.TileBlocking.prototype.style=function(){return"#ffffff"},a.TileBlocking.prototype.blocking=!0,a.TileBlocking.prototype.render=function(b,c){a.style(this.style()).square(b,c)},a.TileNonBlocking=function(b){var c=a.TileBlocking();return c.blocking=!1,void 0!==b&&(c.style=function(){return b}),c},a.TileWall=function(b){var c=a.TileBlocking();return void 0!==b&&(c.style=function(){return b}),c},a.TileImg=function(b){var c=a.TileBlocking();return c.image_id=b.id,c.image_x=b.x,c.image_y=b.y,c.image_w=b.w,c.image_h=b.h,c.render=function(a,b){void 0!==h[c.image_id]&&d.drawImage(h[c.image_id],c.image_x,c.image_y,c.image_w,c.image_h,a*i.tileWidth,b*i.tileHeight,i.tileWidth,i.tileHeight)},c},a.TileImgFull=function(b){var c=a.TileBlocking();return c.image_id=b.id,c.image_x=b.x,c.image_y=b.y,c.image_w=b.w,c.image_h=b.h,c.scale=b.scale||1,c.render=function(a,b){void 0!==h[c.image_id]&&d.drawImage(h[c.image_id],c.image_x,c.image_y,c.image_w,c.image_h,a*i.tileWidth,b*i.tileHeight,c.image_w*c.scale,c.image_h*c.scale)},c},a.TileImgNoBlock=function(b,c){var d,e=a.TileImg(b);c=c||{},e.blocking=!1;for(d in c)c.hasOwnProperty(d)&&(e[d]=c[d]);return e},a.TilePlayerSpawn=function(){return this instanceof a.TilePlayerSpawn?void 0:new a.TilePlayerSpawn},a.TilePlayerSpawn.prototype.render=function(a,b){},a.registerKeydown=function(a){return e.push(a),this},a.unregisterKeydown=function(a){for(var b=e.length;b>=0;b-=1)e[b]===a&&e.splice(b,1);return this},a.keydown=function(a){return e.forEach(function(b){b(a)}),this},a.clear=function(){return a.style(i.backgroundColor),d.fillRect(0,0,c.width,c.height),a.style(i.foregroundColor),this},a.style=function(a){return d.fillStyle=a,this},a.write=function(a,b,c){"string"!=typeof a&&(a=a.toString());for(var e=0;e<a.length;e+=1)d.fillText(a[e],(b+e+1)*i.tileWidth-9,(c+1)*i.tileWidth-1);return this},a.square=function(a,b){return d.fillRect(a*i.tileWidth,b*i.tileHeight,i.tileWidth,i.tileHeight),this},a.addTile=function(a,c,d){var e=void 0===d?this.TileBlocking():d;return b.push({x:a,y:c,t:e}),this},a.canMoveTo=function(a,c){var d=!0;return b.forEach(function(b){b.x===a&&b.y===c&&b.t.blocking===!0&&(d=!1)}),d},a.canvas=function(a){for(var b in a)a.hasOwnProperty(b)&&(i[b]=a[b]);return c=document.createElement("canvas"),d=c.getContext("2d"),c.width=i.width*i.tileWidth,c.height=i.height*i.tileHeight,this.clear(),d.font=i.font,d.textAlign=i.textAlign,d.imageSmoothingEnabled=i.imageSmoothingEnabled,c},a.create=function(a,b){return c=this.canvas(b),document.getElementById(a).appendChild(c),this},a.render=function(a,c){return a=a||0,c=c||0,b.forEach(function(b){b.x>=a&&b.x<a+i.width&&b.y>=c&&b.y<c+i.height&&(i.alwaysShowTiles===!0||b.visible!==!1?b.t.render(b.x-a,b.y-c):b.observed===!0&&(d.globalAlpha=i.baseAlpha,b.t.render(b.x-a,b.y-c),d.globalAlpha=1))}),this},a.cx=function(){return Math.floor(i.width/2)},a.cy=function(){return Math.floor(i.height/2)},a.loadImage=function(a,b,c){var d=new Image;return d.src=a,d.onload=function(){h[b]=this,void 0!==c&&c()},this},a.updateBlocking=function(){return g={},b.forEach(function(a){a.t.blocking===!0&&(g[a.x]=g[a.x]||{},g[a.x][a.y]=!0)}),this},a.updateTilesIndex=function(){return f={},b.forEach(function(a){f[a.x]=f[a.x]||{},f[a.x][a.y]=f[a.x][a.y]||[],f[a.x][a.y].push(a.t)}),this},a.blockedLine=function(a,b,c,d){for(var e,f=Math.abs(c-a),h=c>a?1:-1,i=Math.abs(d-b),j=d>b?1:-1,k=(f>i?f:-i)/2;;){if(a===c&&b===d)break;if(g[a]&&g[a][b]===!0)return!0;e=k,e>-f&&(k-=i,a+=h),i>e&&(k+=f,b+=j)}return!1},a.updateVisible=function(c,d,e){return b.forEach(function(b){if(b.visible=!1,!a.blockedLine(c,d,b.x,b.y)){if(void 0!==e){var f=Math.sqrt(Math.pow(c-b.x,2)+Math.pow(d-b.y,2));if(f>e)return}b.visible=!0,b.observed=!0}}),this},a.isKey=function(a,b){var c;for(c in b)if(b.hasOwnProperty(c)&&a[c]!==b[c])return!1;return!0},a.setTiles=function(c){return b=c,a.updateBlocking().updateTilesIndex(),this},a.applyTiles=function(a){return b.forEach(a),this},a.fillRect=function(a,b,c,e){return d.fillRect(a,b,c,e),this},a.globalAlpha=function(a){return a=a||1,d.globalAlpha=a,this},a.canvasWidth=function(){return i.width*i.tileWidth},a.canvasHeight=function(){return i.height*i.tileHeight},a.tilesAt=function(a,c,d){var e=[];return d=d||b,d.forEach(function(b){b.x===a&&b.y===c&&e.push(b)}),e},a.removeTilesAt=function(a,c,d){var e;for(d=d||b,e=d.length-1;e>=0;e-=1)d[e].x===a&&d[e].y===c&&d.splice(e,1);return this},a.keepTopBlockingTiles=function(a){var c,d,e={};for(a=a||b,c=a.length-1;c>=0;c-=1)a[c].blocking!==!1&&(d=a[c].x+","+a[c].y,void 0!==e[d]&&a.splice(c,1),e[d]=!0);return this},window.addEventListener("keydown",a.keydown),a}();